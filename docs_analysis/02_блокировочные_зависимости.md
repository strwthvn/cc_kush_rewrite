# Блокировочные зависимости секций КУШ

## Обзор системы блокировок

Система блокировок обеспечивает безопасную работу оборудования и защиту от аварийных ситуаций. Блокировки делятся на:
- **Локальные**: внутри одной секции
- **Межсекционные**: между разными секциями
- **Глобальные**: влияют на всю систему

---

## Секция 1: Модульный бункер-накопитель

### Блокировки вибропитателей

| Условие | Действие | Тип |
|---------|----------|-----|
| Пустой бункер (вес = 0) | Запрет запуска | Локальная |
| Опустошение бункера | Остановка | Локальная |
| Перегрев статора | Запрет запуска | Локальная |
| Перегрев статора (во время работы) | Остановка | Локальная |
| Авария ПЧ | Запрет/Остановка | Локальная |

### Блокировки виброобрушения

| Условие | Действие | Тип |
|---------|----------|-----|
| Авария ПЧ | Запрет/Остановка | Локальная |
| Перегрев подшипников | Запрет запуска до снижения температуры | Локальная |

### Блокировки светофора

| Условие | Действие | Тип |
|---------|----------|-----|
| Максимальный вес бункера | Красный сигнал | Локальная |
| Авария СУ КУШ | Красный сигнал (отключаемо) | Глобальная |
| Попытка включить зеленый при перегрузке | Игнорирование команды | Локальная |

---

## Секция 2: Сборный ленточный конвейер

### Блокировки запуска

| Условие | Действие | Тип |
|---------|----------|-----|
| 2+ бункера пустые | Запрет запуска | Межсекционная |
| Перегрев статора | Запрет запуска | Локальная |

### Блокировки остановки (каскадные)

При срабатывании следующих условий останавливается:
- **Сборный конвейер**
- **Виброобрушение** (опционально отключаемо)
- **Пневмообрушение**
- **Вибропитатели**

| Условие | Тип |
|---------|-----|
| Опустошение 2+ бункеров | Межсекционная |
| Перегрев статора конвейера | Локальная |
| Расхождение скорости ленты и задания | Локальная |
| Срабатывание металлодетектора | Локальная |
| Продольный разрыв ленты | Локальная |
| Заштыбовка | Локальная |

---

## Секция 3: Отвалообразователь

### Блокировки запуска ленты

| Условие | Действие | Тип |
|---------|----------|-----|
| 2+ бункера пустые | Запрет запуска | Межсекционная |
| Перегрев статора приводов | Запрет запуска | Локальная |

### Блокировки запуска поворота

| Условие | Действие | Тип |
|---------|----------|-----|
| Сработал концевой датчик в направлении поворота | Запрет поворота в эту сторону | Локальная |

### Блокировки остановки (полный каскад)

При срабатывании следующих условий останавливается:
- **Отвалообразователь**
- **Сборный конвейер**
- **Виброобрушение** (опционально отключаемо)
- **Пневмообрушение**
- **Вибропитатели**

| Условие | Тип |
|---------|-----|
| Опустошение 2+ бункеров | Межсекционная |
| Перегрев статора отвалообразователя | Локальная |
| Расхождение скорости ленты и задания | Локальная |
| Срабатывание металлодетектора | Межсекционная (от конвейера) |
| Продольный разрыв ленты | Локальная |
| Заштыбовка | Локальная |

---

## Матрица межсекционных зависимостей

### Условия для запуска

```
┌─────────────────┬──────────────┬──────────────┬─────────────────┐
│ Оборудование    │ Бункеры (3)  │ Конвейер     │ Отвалообр.      │
├─────────────────┼──────────────┼──────────────┼─────────────────┤
│ Вибропитатели   │ Вес > 0      │ Работает     │ Работает        │
│ Сборный конв.   │ 2+ с весом   │ -            │ Работает        │
│ Отвалообр.      │ 2+ с весом   │ -            │ -               │
└─────────────────┴──────────────┴──────────────┴─────────────────┘
```

### Каскад остановки

При аварии оборудования происходит остановка вышестоящего оборудования:

```
Отвалообразователь ──► Сборный конвейер ──► Вибропитатели
        │                     │                    │
        └─────────────────────┴────────────────────┘
                              │
                    Виброобрушение (опция)
                              │
                    Пневмообрушение
```

### Порядок запуска (обратный каскаду остановки)

```
1. Отвалообразователь   → Ждать выход на режим
2. Сборный конвейер     → Ждать выход на режим
3. Вибропитатели        → Последовательно с проверкой КИУМ
4. Доп. нагрузки        → По необходимости с проверкой КИУМ
```

---

## Глобальные блокировки

### КИУМ (Коэффициент использования мощности)

**Принцип**: перед каждым включением нагрузки проверяется доступный бюджет мощности.

**Последовательность проверки**:
1. Получить текущее потребление (сумма всех активных нагрузок)
2. Рассчитать потребление после включения
3. Сравнить с допустимым лимитом
4. Разрешить/запретить включение

**Приоритеты нагрузок**:
1. Отвалообразователь (высший)
2. Сборный конвейер
3. Вибропитатели
4. Вибраторы
5. Компрессор пневмообрушения
6. Поворот отвалообразователя

### Общесистемные блокировки

| Условие | Действие |
|---------|----------|
| Пропорция шихты != 100% | Запрет автоматического режима |
| Активные неквитированные ошибки | Запрет автоматического режима |
| Аварийный останов | Остановка всей системы |

---

## Опционально отключаемые блокировки

Следующие блокировки могут быть отключены администратором системы:

| Блокировка | Секция | По умолчанию |
|------------|--------|--------------|
| Остановка виброобрушения при аварии конвейера | Конвейер | Включена |
| Остановка виброобрушения при аварии отвалообразователя | Отвалообр. | Включена |
| Красный сигнал светофора при аварии СУ | Бункер | Включена |

---

## Логика сброса блокировок

### Автоматический сброс
- Перегрев: при снижении температуры до уставки
- Пустой бункер: при поступлении материала
- Расхождение скорости: при восстановлении соответствия

### Ручной сброс (квитирование)
- Авария ПЧ
- Металлодетектор
- Продольный разрыв
- Заштыбовка
- Срабатывание датчиков безопасности

---

## Диаграмма зависимостей

```
                    ┌─────────────────────┐
                    │  Глобальные условия │
                    │  - КИУМ             │
                    │  - Пропорция=100%   │
                    │  - Нет ошибок       │
                    └──────────┬──────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        │                      │                      │
        ▼                      ▼                      ▼
┌───────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ Бункер 1      │    │ Бункер 2        │    │ Бункер 3        │
│ - Вибропитат. │    │ - Вибропитат.   │    │ - Вибропитат.   │
│ - Виброобруш. │    │ - Виброобруш.   │    │ - Виброобруш.   │
│ - Пневмообр.  │    │ - Пневмообр.    │    │ - Пневмообр.    │
│ - Светофор    │    │ - Светофор      │    │ - Светофор      │
└───────┬───────┘    └────────┬────────┘    └────────┬────────┘
        │                     │                      │
        └─────────────────────┼──────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ Сборный конвейер│
                    │ - Привод        │
                    │ - Металлодет.   │
                    │ - Датчики       │
                    └────────┬────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ Отвалообразов.  │
                    │ - Привод ленты  │
                    │ - Привод повор. │
                    │ - Датчики       │
                    └─────────────────┘
```

---

## Примечания по реализации

### Требования к отображению на SCADA
- Индикация конкретного двигателя при перегреве
- Шкала КИУМ в реальном времени
- Всплывающие окна для недопустимых действий

### Требования к настройке
- Уставки температуры - администратор
- Максимальный вес бункера - администратор
- Периоды таймеров обрушения - оператор/администратор

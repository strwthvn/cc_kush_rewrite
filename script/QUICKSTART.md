# Modbus Register CLI - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
cd /home/dmalikov/dev/cc_kush_rewrite/newProject/script
./modbus_cli.sh
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 1 (–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤) ‚Üí 1 (–í—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã)
```

### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ª—å–∫–æ Holding Registers
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 1 ‚Üí 2 (Holding Registers)
```

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ª—å–∫–æ Input Registers
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 1 ‚Üí 3 (Input Registers)
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ BOOL —Ä–µ–≥–∏—Å—Ç—Ä–∞
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 2 (–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä)
  ‚Üí –¢–∏–ø —Ä–µ–≥–∏—Å—Ç—Ä–∞: 1 (Holding) –∏–ª–∏ 2 (Input)
  ‚Üí –°–µ–∫—Ü–∏—è: –≤—ã–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞
  ‚Üí –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: 1 (BOOL)
  ‚Üí –ê–¥—Ä–µ—Å: 0-65535
  ‚Üí –ë–∏—Ç-–∏–Ω–¥–µ–∫—Å: 0-15
  ‚Üí –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: –Ω–∞–ø—Ä–∏–º–µ—Ä, cmdStart
  ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ: –Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–æ–º–∞–Ω–¥–∞ —Å—Ç–∞—Ä—Ç–∞"
```

### 5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ REAL —Ä–µ–≥–∏—Å—Ç—Ä–∞
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 2 (–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä)
  ‚Üí –¢–∏–ø —Ä–µ–≥–∏—Å—Ç—Ä–∞: 1 (Holding) –∏–ª–∏ 2 (Input)
  ‚Üí –°–µ–∫—Ü–∏—è: –≤—ã–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞
  ‚Üí –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: 2 (REAL)
  ‚Üí –ê–¥—Ä–µ—Å: 30-65535
  ‚Üí –ë–∏—Ç-–∏–Ω–¥–µ–∫—Å: (–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)
  ‚Üí –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: –Ω–∞–ø—Ä–∏–º–µ—Ä, stBunker[1].rWeight
  ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ: –Ω–∞–ø—Ä–∏–º–µ—Ä, "–í–µ—Å –≤ –±—É–Ω–∫–µ—Ä–µ 1"
```

### 6. –ü–æ–∏—Å–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 5 (–ü–æ–∏—Å–∫ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤)
  ‚Üí –í–≤–µ—Å—Ç–∏: "Weight" –∏–ª–∏ "Bunker" –∏–ª–∏ "Frequency"
```

### 7. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 3 (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä)
  ‚Üí –í–≤–µ—Å—Ç–∏ ID —Ä–µ–≥–∏—Å—Ç—Ä–∞ (–∏–∑ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ –ø–æ–∏—Å–∫–∞)
  ‚Üí –í—ã–±—Ä–∞—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:
     1. –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
     2. –û–ø–∏—Å–∞–Ω–∏–µ
     3. –£–¥–∞–ª–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
```

### 8. –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 4 (–£–¥–∞–ª–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä)
  ‚Üí –í–≤–µ—Å—Ç–∏ ID —Ä–µ–≥–∏—Å—Ç—Ä–∞
  ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å: YES
```

### 9. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 6 (–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î)
```

### 10. –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 7 (–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel)
  ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ñ–∞–π–ª modbus_map.xlsx –≤ –ø–∞–ø–∫–µ script/
```

### 11. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ü–∏—è–º–∏
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí 8 (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ü–∏—è–º–∏)
  ‚Üí 1: –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π
  ‚Üí 2: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é
  ‚Üí 4: –£–¥–∞–ª–∏—Ç—å —Å–µ–∫—Ü–∏—é (—Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ!)
```

## –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏

- `Ctrl+C` - –í—ã—Ö–æ–¥ –∏–∑ –ª—é–±–æ–≥–æ –º–µ–Ω—é (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π)
- `0` - –í—ã—Ö–æ–¥ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –º–µ–Ω—é / –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã
- `Enter` (–ø—É—Å—Ç–æ–π –≤–≤–æ–¥) - –û—Ç–º–µ–Ω–∞/–ü—Ä–æ–ø—É—Å–∫ (–≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

## –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

- üîµ **–ì–æ–ª—É–±–æ–π** - BOOL —Ä–µ–≥–∏—Å—Ç—Ä—ã
- üü¢ **–ó–µ–ª—ë–Ω—ã–π** - REAL —Ä–µ–≥–∏—Å—Ç—Ä—ã
- ‚ö™ **–ë–µ–ª—ã–π** - INT/UINT/WORD/DINT —Ä–µ–≥–∏—Å—Ç—Ä—ã

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ù–∞–π—Ç–∏ –≤—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –±—É–Ω–∫–µ—Ä–∞ 1
```
–ü–æ–∏—Å–∫ ‚Üí "Bunker 1" –∏–ª–∏ "–ë—É–Ω–∫–µ—Ä 1"
```

### –ù–∞–π—Ç–∏ –≤—Å–µ —á–∞—Å—Ç–æ—Ç–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã
```
–ü–æ–∏—Å–∫ ‚Üí "Frequency" –∏–ª–∏ "–ß–∞—Å—Ç–æ—Ç–∞"
```

### –ù–∞–π—Ç–∏ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
```
–ü–æ–∏—Å–∫ ‚Üí "cmd" –∏–ª–∏ "–ö–æ–º–∞–Ω–¥–∞"
```

### –ù–∞–π—Ç–∏ –≤—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –≤–µ—Å–∞
```
–ü–æ–∏—Å–∫ ‚Üí "Weight" –∏–ª–∏ "–í–µ—Å"
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
```bash
cd script
python3 migrate_from_fc.py
```

### –û—à–∏–±–∫–∞: "openpyxl –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
cd /home/dmalikov/dev/cc_kush_rewrite/newProject
source venv/bin/activate
pip install openpyxl

# –í–∞—Ä–∏–∞–Ω—Ç 2: –°–∏—Å—Ç–µ–º–Ω—ã–π Python
pip3 install openpyxl
```

### –û—à–∏–±–∫–∞: "Permission denied"
```bash
chmod +x modbus_cli.sh
```

## –ü–æ–¥—Å–∫–∞–∑–∫–∏

1. **–ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–º–µ–Ω—é 8 ‚Üí 1)
2. **–ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–µ–∫—Ü–∏–∏** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∞ –ø—É—Å—Ç–∞—è (–≤ –Ω–µ–π –Ω–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤)
3. **–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é 5 –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
4. **ID —Ä–µ–≥–∏—Å—Ç—Ä–∞** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ
5. **BOOL —Ä–µ–≥–∏—Å—Ç—Ä—ã** —Ç—Ä–µ–±—É—é—Ç –±–∏—Ç-–∏–Ω–¥–µ–∫—Å (0-15), –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã - –Ω–µ—Ç

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î

```
‚úÖ –í—Å–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤: 620
   - Holding Registers: 179 (–∫–æ–º–∞–Ω–¥—ã –∏ —É—Å—Ç–∞–≤–∫–∏)
   - Input Registers: 441 (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)

üìä –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:
   - BOOL: 464 —Ä–µ–≥–∏—Å—Ç—Ä–∞
   - REAL: 156 —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

üîß –°–µ–∫—Ü–∏–∏: ~30 —Å–µ–∫—Ü–∏–π (–±—É–Ω–∫–µ—Ä—ã, –∫–æ–Ω–≤–µ–π–µ—Ä—ã, VFD –∏ —Ç.–¥.)
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ CLI
./modbus_cli.sh

# –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ CLI)
python3 export_to_excel.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
sqlite3 db/modbus_registers.db "SELECT COUNT(*) FROM registers;"

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î
cp db/modbus_registers.db db/modbus_registers_backup_$(date +%Y%m%d).db
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [README_CLI.md](README_CLI.md)
